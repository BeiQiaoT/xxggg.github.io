import{_ as s,c as n,o as a,a as l}from"./app.e883c7a7.js";var p="/assets/0ca56b903a30c845d087d0623d6630f106cbcb81b24b74eef6819f01fc18d47f.0ca56b90.png",o="/assets/c2e4756c20e05d005e7e5fa713d3f3f9652b8ec6b3625dadc3c4fe853b9e895e.c2e4756c.png",e="/assets/cec7eaa819de42b0e4edb2d34fb620869f2dc683cd267a01f2aac3b4b6c04916.cec7eaa8.png",c="/assets/5e85f4618519c97bc3b613b719cdd5ab12815c69d32fa051ce53890a631dc62e.5e85f461.png";const E=JSON.parse('{"title":"\u2B1BExpress+\u2B1CNode+\u{1F42C}MySQL","description":"","frontmatter":{},"headers":[{"level":2,"title":"1\u3001\u521B\u5EFA\u9879\u76EE","slug":"_1\u3001\u521B\u5EFA\u9879\u76EE"},{"level":3,"title":"\u6839\u76EE\u5F55\u521B\u5EFAapp.js","slug":"\u6839\u76EE\u5F55\u521B\u5EFAapp-js"},{"level":3,"title":"\u521B\u5EFA\u8DEF\u7531\u6587\u4EF6\u5939","slug":"\u521B\u5EFA\u8DEF\u7531\u6587\u4EF6\u5939"},{"level":2,"title":"2\u3001\u76EE\u5F55\u7ED3\u6784","slug":"_2\u3001\u76EE\u5F55\u7ED3\u6784"},{"level":2,"title":"3\u3001\u914D\u7F6E\u5E38\u7528\u4E2D\u95F4\u4EF6","slug":"_3\u3001\u914D\u7F6E\u5E38\u7528\u4E2D\u95F4\u4EF6"},{"level":3,"title":"\u8BF7\u6C42\u4E2D\u95F4\u4EF6","slug":"\u8BF7\u6C42\u4E2D\u95F4\u4EF6"},{"level":3,"title":"\u65E5\u5FD7\u8F93\u51FA","slug":"\u65E5\u5FD7\u8F93\u51FA"},{"level":3,"title":"\u4E3A\u5BA2\u6237\u7AEF\u63D0\u4F9B\u8DE8\u57DF\u8D44\u6E90\u8BF7\u6C42","slug":"\u4E3A\u5BA2\u6237\u7AEF\u63D0\u4F9B\u8DE8\u57DF\u8D44\u6E90\u8BF7\u6C42"},{"level":2,"title":"4\u3001\u8DEF\u7531\u6A21\u5757\u{1F447}","slug":"_4\u3001\u8DEF\u7531\u6A21\u5757\u{1F447}"},{"level":2,"title":"5\u3001controller\u3010\u63A7\u5236\u5668\u3011","slug":"_5\u3001controller\u3010\u63A7\u5236\u5668\u3011"},{"level":2,"title":"6\u3001\u9519\u8BEF\u5904\u7406\u{1F447}","slug":"_6\u3001\u9519\u8BEF\u5904\u7406\u{1F447}"},{"level":2,"title":"\u6570\u636E\u5E93\u8FDE\u63A5\u{1F447}","slug":"\u6570\u636E\u5E93\u8FDE\u63A5\u{1F447}"}],"relativePath":"BackEnd/Express/Express_Node_MySQL.md","lastUpdated":1656978196000}'),t={name:"BackEnd/Express/Express_Node_MySQL.md"},r=l(`<h1 id="\u2B1Bexpress-\u2B1Cnode-\u{1F42C}mysql" tabindex="-1">\u2B1BExpress+\u2B1CNode+\u{1F42C}MySQL <a class="header-anchor" href="#\u2B1Bexpress-\u2B1Cnode-\u{1F42C}mysql" aria-hidden="true">#</a></h1><h2 id="_1\u3001\u521B\u5EFA\u9879\u76EE" tabindex="-1">1\u3001\u521B\u5EFA\u9879\u76EE <a class="header-anchor" href="#_1\u3001\u521B\u5EFA\u9879\u76EE" aria-hidden="true">#</a></h2><div class="language-shell"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">npm init -y</span></span>
<span class="line"><span style="color:#A6ACCD;">npm i express</span></span>
<span class="line"><span style="color:#A6ACCD;">npm i nodemon -D</span></span>
<span class="line"><span style="color:#A6ACCD;">npm i mysql2</span></span>
<span class="line"><span style="color:#A6ACCD;">npm i jsonwebtoken</span></span>
<span class="line"><span style="color:#A6ACCD;">npm i express-jwt</span></span>
<span class="line"></span></code></pre></div><p>\u6839\u76EE\u5F55\u6DFB\u52A0nodemon.json</p><div class="language-json"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">watch</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./src/**/*.*</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><div class="language-json"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;">//package.json</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">scripts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">dev</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">nodemon src/app</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"></span></code></pre></div><h3 id="\u6839\u76EE\u5F55\u521B\u5EFAapp-js" tabindex="-1">\u6839\u76EE\u5F55\u521B\u5EFAapp.js <a class="header-anchor" href="#\u6839\u76EE\u5F55\u521B\u5EFAapp-js" aria-hidden="true">#</a></h3><div class="language-javascript"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> express </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">express</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> app </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">express</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h3 id="\u521B\u5EFA\u8DEF\u7531\u6587\u4EF6\u5939" tabindex="-1">\u521B\u5EFA\u8DEF\u7531\u6587\u4EF6\u5939 <a class="header-anchor" href="#\u521B\u5EFA\u8DEF\u7531\u6587\u4EF6\u5939" aria-hidden="true">#</a></h3><p>router/index.js</p><div class="language-javascript"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;">//index.js</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> express </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">express</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> router </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> express</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Router</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> mysql </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">mysql2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> jwt </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">jsonwebtoken</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">expressjwt</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> expressJWT </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">express-jwt</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//\u521B\u5EFA\u6570\u636E\u5E93\u3010\u8FDE\u63A5\u3011/\u3010\u5173\u95ED\u3011</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//\u7528\u6237\u6CE8\u518C</span></span>
<span class="line"><span style="color:#A6ACCD;">router</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/register</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> next</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">post /users/login</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//\u7528\u6237\u767B\u5F55</span></span>
<span class="line"><span style="color:#A6ACCD;">router</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/login</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> next</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">post /users/login</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//\u83B7\u53D6todolist</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//\u66F4\u65B0todolist</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//\u83B7\u53D6MarkBook</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//\u66F4\u65B0MarkBook</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> router</span></span>
<span class="line"></span></code></pre></div><h2 id="_2\u3001\u76EE\u5F55\u7ED3\u6784" tabindex="-1">2\u3001\u76EE\u5F55\u7ED3\u6784 <a class="header-anchor" href="#_2\u3001\u76EE\u5F55\u7ED3\u6784" aria-hidden="true">#</a></h2><p>\u521B\u5EFAconfig/config.default.js\u3010\u914D\u7F6E\u6587\u4EF6\u3011</p><div class="language-javascript"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">* \u9ED8\u8BA4\u914D\u7F6E</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">*/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports={}</span><span style="color:#A6ACCD;">							</span></span>
<span class="line"></span></code></pre></div><p>controller \u3010\u89E3\u6790\u7528\u6237\u7684\u8F93\u5165\uFF0C\u5904\u7406\u540E\u53CD\u5E94\u76F8\u5E94\u7684\u7ED3\u679C\u3011\u3010\u63A7\u5236\u5668\u3011 model\u3010\u6570\u636E\u6301\u4E45\u5C42\u3011 middleware\u3010\u975E\u8DEF\u7531\u7684\u4E2D\u95F4\u4EF6\u3011 router\u3010\u8DEF\u7531\u3011 util\u3010\u5DE5\u5177\u6A21\u5757\u3011 app.js\u3010\u542F\u52A8\u6587\u4EF6\u3011</p><h2 id="_3\u3001\u914D\u7F6E\u5E38\u7528\u4E2D\u95F4\u4EF6" tabindex="-1">3\u3001\u914D\u7F6E\u5E38\u7528\u4E2D\u95F4\u4EF6 <a class="header-anchor" href="#_3\u3001\u914D\u7F6E\u5E38\u7528\u4E2D\u95F4\u4EF6" aria-hidden="true">#</a></h2><h3 id="\u8BF7\u6C42\u4E2D\u95F4\u4EF6" tabindex="-1">\u8BF7\u6C42\u4E2D\u95F4\u4EF6 <a class="header-anchor" href="#\u8BF7\u6C42\u4E2D\u95F4\u4EF6" aria-hidden="true">#</a></h3><ul><li>express.json()</li><li>express.urlencoded()</li></ul><div class="language-javascript"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(express</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">json</span><span style="color:#A6ACCD;">())</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(express</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">urlencoded</span><span style="color:#A6ACCD;">())</span></span>
<span class="line"></span></code></pre></div><h3 id="\u65E5\u5FD7\u8F93\u51FA" tabindex="-1">\u65E5\u5FD7\u8F93\u51FA <a class="header-anchor" href="#\u65E5\u5FD7\u8F93\u51FA" aria-hidden="true">#</a></h3><ul><li>morgan()\u3010\u7B2C\u4E09\u65B9 \u9700\u8981\u5B89\u88C5\u3011\u3010\u653E\u5728\u9884\u5904\u7406\u5904\u3011</li><li>npm i morgan</li></ul><div class="language-javascript"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">morgan</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">dev</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">))</span><span style="color:#676E95;font-style:italic;">//\u5F00\u53D1\u4E00\u822C\u4F7F\u7528dev</span></span>
<span class="line"></span></code></pre></div><h3 id="\u4E3A\u5BA2\u6237\u7AEF\u63D0\u4F9B\u8DE8\u57DF\u8D44\u6E90\u8BF7\u6C42" tabindex="-1">\u4E3A\u5BA2\u6237\u7AEF\u63D0\u4F9B\u8DE8\u57DF\u8D44\u6E90\u8BF7\u6C42 <a class="header-anchor" href="#\u4E3A\u5BA2\u6237\u7AEF\u63D0\u4F9B\u8DE8\u57DF\u8D44\u6E90\u8BF7\u6C42" aria-hidden="true">#</a></h3><ul><li>cors()\u3010\u4E5F\u9700\u8981\u5B89\u88C5\u3011\u3010\u653E\u5728\u9884\u5904\u7406\u5904\u3011</li></ul><div class="language-shell"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">npm i cors</span></span>
<span class="line"></span></code></pre></div><div class="language-javascript"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">cors</span><span style="color:#A6ACCD;">())</span></span>
<span class="line"></span></code></pre></div><h2 id="_4\u3001\u8DEF\u7531\u6A21\u5757\u{1F447}" tabindex="-1">4\u3001\u8DEF\u7531\u6A21\u5757\u{1F447} <a class="header-anchor" href="#_4\u3001\u8DEF\u7531\u6A21\u5757\u{1F447}" aria-hidden="true">#</a></h2><p><img src="`+p+`" alt="\u56FE 17"></p><p>\u628A\u5176\u4ED6\u6A21\u5757\u6302\u8F7D\u5728index.js \u4E3B\u8DEF\u7531\u4E2D\uFF01</p><div class="language-javascript"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;">//index.js</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> express </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">express</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> router </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> express</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Router</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//\u7528\u6237\u76F8\u5173\u8DEF\u7531</span></span>
<span class="line"><span style="color:#A6ACCD;">router</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./user</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//\u6587\u7AE0\u76F8\u5173\u8DEF\u7531</span></span>
<span class="line"><span style="color:#A6ACCD;">router</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./profiles</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> router</span></span>
<span class="line"></span></code></pre></div><div class="language-javascript"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;">//user.js</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> express </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">express</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> router </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> express</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Router</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//\u7528\u6237\u767B\u5F55</span></span>
<span class="line"><span style="color:#A6ACCD;">router</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/users/login</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> next</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">post /users/login</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> router</span></span>
<span class="line"></span></code></pre></div><h2 id="_5\u3001controller\u3010\u63A7\u5236\u5668\u3011" tabindex="-1">5\u3001controller\u3010\u63A7\u5236\u5668\u3011 <a class="header-anchor" href="#_5\u3001controller\u3010\u63A7\u5236\u5668\u3011" aria-hidden="true">#</a></h2><p>\u4E00\u822C\u6765\u8BF4 \u5728router\u63A7\u5236\u63A5\u53E3\u7684\u8DEF\u7531\uFF0C\u800C\u5BF9\u5E94\u7684\u63A5\u53E3\u6709\u5BF9\u5E94\u7684\u529F\u80FD\uFF0C\u4F46\u662F\u5982\u679C\u529F\u80FD\u9700\u8981\u5199\u5F88\u591A\u4EE3\u7801\uFF0C\u5168\u90E8\u529F\u80FD\u90FD\u6324\u5728\u4E00\u4E2A\u8DEF\u7531\u6587\u4EF6\u91CC\u5C31\u4E0D\u662F\u5F88\u597D\u7EF4\u62A4\uFF01 \u6240\u4EE5\u5728\u8DEF\u7531\u6587\u4EF6\u91CC\u5C31\u53EA\u7406\u8DEF\u7531\uFF0C\u628A\u8DEF\u7531\u5230\u540E\u9700\u8981\u5904\u7406\u7684\u65B9\u6CD5\u518D\u5355\u72EC\u653E\u5230\u53E6\u4E00\u4E2A\u6587\u4EF6\u5939\u3010controller\u3011\u91CC <img src="`+o+'" alt="\u56FE 19"><br><img src="'+e+`" alt="\u56FE 20"></p><div class="language-javascript"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;">//\u7528\u6237\u767B\u5F55</span></span>
<span class="line"><span style="color:#89DDFF;">exports.</span><span style="color:#82AAFF;">login</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> next</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">post /users/login</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//\u7528\u6237\u6CE8\u518C</span></span>
<span class="line"><span style="color:#89DDFF;">exports.</span><span style="color:#82AAFF;">register</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> next</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">get /users</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h2 id="_6\u3001\u9519\u8BEF\u5904\u7406\u{1F447}" tabindex="-1">6\u3001\u9519\u8BEF\u5904\u7406\u{1F447} <a class="header-anchor" href="#_6\u3001\u9519\u8BEF\u5904\u7406\u{1F447}" aria-hidden="true">#</a></h2><div class="language-javascript"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;">//5\u3001\u9519\u8BEF\u5904\u7406</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> errorHandler </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">../middleware/error-handler</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">errorHandler</span><span style="color:#A6ACCD;">())</span></span>
<span class="line"></span></code></pre></div><p><img src="`+c+`" alt="\u56FE 21"></p><div class="language-javascript"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">next</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">		</span><span style="color:#676E95;font-style:italic;">//token\u89E3\u6790\u5931\u8D25\u5BFC\u81F4\u7684\u9519\u8BEF</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">err</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">name</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">UnauthorizedError</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> status</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">401</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> message</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">\u65E0\u6548\u7684token</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">		</span></span>
<span class="line"><span style="color:#89DDFF;">		</span><span style="color:#676E95;font-style:italic;">//\u5176\u4ED6\u539F\u56E0\u5BFC\u81F4\u7684\u9519\u8BEF</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> status</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">500</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> message</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">\u672A\u77E5\u9519\u8BEF</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h2 id="\u6570\u636E\u5E93\u8FDE\u63A5\u{1F447}" tabindex="-1">\u6570\u636E\u5E93\u8FDE\u63A5\u{1F447} <a class="header-anchor" href="#\u6570\u636E\u5E93\u8FDE\u63A5\u{1F447}" aria-hidden="true">#</a></h2><ol><li>\u6570\u636E\u5E93\u8FDE\u63A5</li><li>\u8FDE\u63A5\u5931\u8D25</li><li>\u8FDE\u63A5\u6210\u529F</li><li>\u521B\u5EFA\u4E00\u4E2A\u6A21\u578B</li></ol>`,40),y=[r];function D(F,A,i,C,d,u){return a(),n("div",null,y)}var f=s(t,[["render",D]]);export{E as __pageData,f as default};
